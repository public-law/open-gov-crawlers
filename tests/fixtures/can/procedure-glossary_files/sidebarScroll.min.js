//TODO: Implement bootstrap 5 scrollSpy: https://getbootstrap.com/docs/5.0/components/scrollspy/
/*
  var sidebarOffsetTop = webBannerHeight + subsiteNavHeight + 20;
    var sidebarOffsetBottom = $("#contact-us-content-container").outerHeight(true) + 30;

    var scrollSpy = new bootstrap.ScrollSpy(document.body, {
        target: '#sidebar'
    })
 * */

// ************************************************************
// Sticky Navigation (sidebar)
// ************************************************************


function OnScroll() {

    var mediaWidth = window.matchMedia("(min-width: 992px)")

    let sidebarButtons = $('#sidebar');

    if (mediaWidth.matches) { // If media query matches

        var CEBannerHeight = 0;
        if ($(".ce-hoc").height() != undefined) {
            CEBannerHeight = $(".ce-hoc").height();
        }

        var topMenuHeight = 0;
        if ($("#top-menu-container").height() != undefined) {
            topMenuHeight = $("#top-menu-container").height();
        }

        var webBannerHeight = 0;
        if ($(".web-banner").height() != undefined) {
            webBannerHeight = $(".web-banner").height();
        }

        var subsiteNavHeight = 0;
        if ($(".subsite-nav").height() != undefined) {
            subsiteNavHeight = $(".subsite-nav").height();
        }

        var ceFooterHeight = 0;
        if ($('#ce-hoc-footer').height() != undefined) {
            ceFooterHeight = $("#ce-hoc-footer").height();
        }

        //contact-us-content-container
        var contactUsHeight = 0;
        if ($('.contact-us-content-container').height() != undefined) {
            contactUsHeight = $(".contact-us-content-container").height();
        }

        var sidebarOffsetTop = CEBannerHeight + webBannerHeight + topMenuHeight + subsiteNavHeight + 20;
        var sidebarOffsetBottom = ceFooterHeight + contactUsHeight + 20;

        var bottomReachTop = document.body.clientHeight - (document.body.scrollTop || document.documentElement.scrollTop) - sidebarButtons.height() - sidebarOffsetBottom - 30;

        // handle the scroll event
        if ((document.body.scrollTop > sidebarOffsetTop || document.documentElement.scrollTop > sidebarOffsetTop) && bottomReachTop > 0) {
            sidebarButtons.css(
                {
                    'top': 20,
                    'position': 'fixed'
                });
        } else if ((document.body.scrollTop > sidebarOffsetTop || document.documentElement.scrollTop > sidebarOffsetTop) && bottomReachTop < 0) {
            // Check Bottom
            sidebarButtons.css(
                {
                    'top': bottomReachTop,
                    'position': 'fixed'
                });
        } else {
            sidebarButtons.css(
                {
                    'top': 'inherit',
                    'position': 'absolute'
                });
        }
    } else { // If media query NOT matches
        sidebarButtons.css(
            {
                'top': 'inherit',
                'position': 'inherit'
            });
    }
}



$(document).ready(function () {
    window.addEventListener('scroll', function () {
        OnScroll();
    });
});